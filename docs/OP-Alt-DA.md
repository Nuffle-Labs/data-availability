# How to use OP Alt-DA with NEAR DA

## Introduction

This is a guide on how to run NEAR DA with OP Alt-DA mode. The instructions will cover localnet and testnet.

### Setup DA Server

Follow the instructions in [Getting Started](https://github.com/Nuffle-Labs/data-availability/blob/main/README.md#getting-started) section of the main repository.

The main two things to look out for when configuring the NEAR DA Server are:

While running `docker compose`, `http-sidecar.json` should be set correctly depending on the environment that you would like to run the NEAR DA sidecar for.

For localnet:

``` json
{
  "account_id": "test.near",
  "secret_key": "ed25519:4dagBsEqCv3Ao5wa4KKFa57xNAH4wuBjh9wdTNYeCqDSeA9zE7fCnHSvWpU8t68jUpcCGqgfYwcH68suPaqmdcgm",
  "contract_id": "test.near",
  "network": "http://near-localnet:3030",
  "namespace": null,
  "should_cache": false
}

```

For testing localnet setup with NEAR DA sidecar, run `docker-compose up` in the root of the repository. 3 containers including `near-localnet`, `near-localnet-set-key` and `near-da-sidecar` will run.

For testnet:

``` json
{
  "account_id": "<your-testnet-account.testnet>",
  "secret_key": "ed25519:4dagBsEqCv3Ao5wa4KKFa57xNAH4wuBjh9wdTNYeCqDSeA9zE7fCnHSvWpU8t68jUpcCGqgfYwcH68suPaqmdcgm",
  "contract_id": "<your-testnet-account.testnet>",
  "network": "https://rpc.testnet.near.org",
  "namespace": null,
  "should_cache": false
}

```

### Configure OP Node

Follow the instructions [in OP Create L2 Rollup](https://docs.optimism.io/builders/chain-operators/tutorials/create-l2-rollup) to set up your OP Node.

Check the ports in `docker-compose` file for the DA server
``` yml
services:
  near-da-sidecar:
    container_name: near-da-sidecar
    image: ghcr.io/nuffle-labs/data-availability/sidecar:dev
    # build:
    #   context: .
    #   dockerfile: bin/http-api/Dockerfile
    restart: unless-stopped
    depends_on:
      - near-localnet-set-key
    environment:
      - RUST_LOG=debug
    volumes:
      - ./test/http-sidecar.json:/app/config.json
    command:
      - -c
      - /app/config.json
    ports:
      - 5888:5888
```

Set --altda.enabled=true and point both op-batcher and op-node to the DA server.
No configuration changes are required for op-geth or op-proposer.
   Alt-DA (EXPERIMENTAL)
   
    --altda.da-server value                                               ($OP_NODE_ALTDA_DA_SERVER)
          HTTP address of a DA Server
   
    --altda.enabled                    (default: false)                   ($OP_NODE_ALTDA_ENABLED)
          Enable Alt-DA mode
   
    --altda.verify-on-read             (default: true)                    ($OP_NODE_ALTDA_VERIFY_ON_READ)
          Verify input data matches the commitments from the DA storage service

Configure Your Batcher
Set --altda.enabled=true and --altda.da-service=true.
Provide the URL for --atlda.da-server=$DA_SERVER_HTTP_URL.

```
--altda.da-server value                                               ($OP_BATCHER_ALTDA_DA_SERVER)
          HTTP address of a DA Server
```
    --altda.da-service                 (default: false)                   ($OP_BATCHER_ALTDA_DA_SERVICE)
          Use DA service type where commitments are generated by the DA server
   
    --altda.enabled                    (default: false)                   ($OP_BATCHER_ALTDA_ENABLED)
          Enable Alt-DA mode
   
    --altda.verify-on-read             (default: true)                    ($OP_BATCHER_ALTDA_VERIFY_ON_READ)
          Verify input data matches the commitments from the DA storage service
